#+TITLE: Описание работы движка

* Структура автомата

  Автомат хранит такие основные сущности: текущее состояние (state), множество всех состояний автомата (states), шаблон описывающий работу автомата (template) и дополнительную информацию описывающую текущее состояние среды автомата (data). По мимо этого он может опционально хранить историю состояний.

  Состояние представляет из себя объект типа keyword

** Шаблон автомата

   Поле template содержащее шаблон автомата это hash-map с ключём типа keyword (состояние автомата) и значением типа hash-map (информация о состоянии)
   
   *Пример шаблона:*

#+NAME: Пример шаблона
#+BEGIN_SRC clojure
{:a {...}
 :b {...}}
#+END_SRC

*** Информация о обычном состоянии

   Информация о состоянии содержит следующие ключи:

   - *:discription* - содержит текстовое описание состояния. Значение типа String

   - *:in-action* - действие которое выполнится при переходе в данное состояние. Содержит функцию которая принимает поле data из объекта автомата и возвращает новое значение data. 

   - *:action* - действие которое выполнится каждую проверку автомата.

   - *:out-action* - действие которое выполнится при переходе из данного состояния. Содержит функцию которая принимает поле data из объекта автомата и возвращает новое значение data.

   - *:egdes* - описывает переходы в другие состояния. Представляет массив из hash-map описывающих переход

   - *:parent* - ближайшее иерархическое состояние в котором находится текущее состояние

   - *:type* - тип состояние (конечное, иерархическое и т.д.). 

     - *:normal* - обычное состояние конечного автомата

   *Пример информации о состоянии:*

#+NAME: Пример информации о состоянии
#+BEGIN_SRC clojure
{:discription ""
 :in-action (fn [x] x)
 :out-action foo
 :edges [...]
 :type :normal}
#+END_SRC

*** Информация о иерархическом состоянии

   Информация о состоянии содержит следующие ключи:

   - *:discription* - содержит текстовое описание состояния. Значение типа String

   - *:action* - действие которое выполнится каждую проверку автомата.

   - *:in-action* - действие которое выполнится при переходе в данное состояние. Содержит функцию которая принимает поле data из объекта автомата и возвращает новое значение data. 

   - *:out-action* - действие которое выполнится при переходе из данного состояния. Содержит функцию которая принимает поле data из объекта автомата и возвращает новое значение data.

   - *:parent* - ближайшее иерархическое состояние в котором находится текущее состояние

   - *:egdes* - описывает переходы в другие состояния. Представляет массив из hash-map описывающих переход
 
   - *:start-state* - описывает переходы в другие состояния. Представляет массив из hash-map описывающих переход

   - *:type* - тип состояние

     - *:heir* - иерархическое состояние. По сути представляет из себя конечный автомат.



*** Описание переходов
    
    В поле *:edges* хранятся hash-map с такими ключами:

   - *:discription* - содержит текстовое описание перехода. Значение типа String

   - *:state* - состояние в которое происходит переход

   - *:valid?* - проверка на то является ли переход в это состояние валидным или нет. Содержит функцию которая принимает поле data из объекта автомата и возвращает булево значение.

#+NAME: Пример описания перехода
#+BEGIN_SRC clojure
{:state b
 :discription }
 :valid? (fn [x] True)}
#+END_SRC


